# Generated by `dev init rails`.
# Working on a new project? Prefer running the generator to copying this file.
name: onboarding-sandbox

up:
  - homebrew:
    - openssl
    - shopify/shopify/mysql-client:
        or:        [mysql]
        conflicts: [mysql-connector-c]
  - ruby:
      package: shopify/shopify/shopify-ruby
      version: 2.2.3p172-shopify
  - railgun
  - bundler
  - custom:
      met?: test -f config/keys.yml
      meet: cp config/keys.sample.yml config/keys.yml
  - database:
      bootstrap: bundle exec rake db:setup db:test:prepare
      migrate: bin/rake db:migrate db:test:prepare
      host: onboarding-sandbox.railgun
      user: root
      password: ""
      database: onboarding-sandbox_development

# Add project-local commands. desc and run are required.
# the syntax property is kind of complex, but only used to generate output in
# `dev help`. You can leave it blank, or dig into the code in Dev::Help.
commands:
  console:
    desc:   'start a rails console'
    run:    bin/rails console
  server:
    desc:   'start a rails server'
    run:    bin/rails server -b 192.168.64.1 -p 63498
  test:
    syntax:
      argument: file
      optional: args...
    desc:   'run a single test file'
    run:    bundle exec ruby -Itest "$@"

# These use fuzzy-matching, so you can `dev open ad` if you have a line with
# "Shopify Admin". You should change "My Application" to something else.
open:
  "My Application": https://onboarding-sandbox.myshopify.io

railgun:
  image: dev:railgun-common-services-0.2.x
  services:
    # redis:         6379
    # memcached:    11211
    # toxiproxy:     8474
    mysql:         3306
    # elasticsearch: 9200
    # zookeeper:     2181
    # argus:         8001
    # magellan:      8438
    # imagery:      25300
    nginx:           80
  ip_address: 192.168.64.43
  memory: 2G
  cores: 2
  disk: 2G
  # proxy sets up an nginx config in the VM so that
  # https://onboarding-sandbox.myshopify.io routes into the VM, and it then proxies back
  # out to the given port on your host OS X
  proxy:
    onboarding-sandbox.myshopify.io: 63498
